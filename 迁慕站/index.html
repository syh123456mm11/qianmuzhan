<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ…•ç«™ - æ–‡ä»¶å…±äº«å¹³å°</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="public-page">
    <header class="public-header">
        <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
            <div id="logoContainer" style="cursor: pointer; display: inline-block;" title="è¿æ…•ç«™">
                <img src="è¿æ…•Qå’ŒMç»“åˆlogoè®¾è®¡ (1).png" style="width: 48px; height: 48px; margin-bottom: 16px; vertical-align: middle;">
            </div>
            <h1>è¿æ…•ç«™</h1>
            <p style="color: #6b7280; margin-top: 8px;">å®‰å…¨æ–‡ä»¶å…±äº«å¹³å° - æ‰€æœ‰æ–‡ä»¶å¯ä¾›æµè§ˆä¸‹è½½</p>
        </div>
    </header>

    <main class="public-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <div>
                <h2 style="font-size: 24px; font-weight: 600; color: #1f2937; margin-bottom: 4px;">å…¬å…±æ–‡ä»¶</h2>
                <p style="color: #6b7280;">æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶å®æ—¶æ›´æ–°ï¼Œæ¬¢è¿ä¸‹è½½ä½¿ç”¨</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <input type="text" id="searchInput" placeholder="æœç´¢æ–‡ä»¶..." 
                       style="padding: 10px 16px; border: 1px solid #d1d5db; border-radius: 6px; width: 250px; font-size: 14px;">
                <select id="sortSelect" style="padding: 10px 16px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                    <option value="name">æŒ‰åç§°æ’åº</option>
                    <option value="date">æŒ‰æ—¶é—´æ’åº</option>
                    <option value="size">æŒ‰å¤§å°æ’åº</option>
                    <option value="downloads">æŒ‰ä¸‹è½½é‡æ’åº</option>
                </select>
            </div>
        </div>

        <div id="filesContainer">
            <div class="file-grid" id="fileGrid">
                <!-- åŠ¨æ€åŠ è½½æ–‡ä»¶å¡ç‰‡ -->
            </div>
            
            <div id="loadingState" style="text-align: center; padding: 60px;">
                <div class="loading"></div>
                <p style="margin-top: 16px; color: #6b7280;">åŠ è½½ä¸­...</p>
            </div>
            
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ“­</div>
                <h3 style="margin-bottom: 8px; color: #374151;">æš‚æ— æ–‡ä»¶</h3>
                <p style="color: #6b7280;">æ–‡ä»¶åº“ä¸ºç©ºï¼Œè¯·ç¨åå†è¯•</p>
            </div>
        </div>
    </main>

    <footer style="background: white; border-top: 1px solid #e5e7eb; padding: 24px; text-align: center; margin-top: 60px;">
        <p style="color: #6b7280; font-size: 14px;">Â© 2024 è¿æ…•ç«™ - å®‰å…¨æ–‡ä»¶å…±äº«å¹³å°</p>
    </footer>

    <!-- å¯†ç è¾“å…¥æ¨¡æ€æ¡†ï¼ˆéšè—çš„ç®¡ç†å…¥å£ï¼‰ -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal-content password-modal">
            <div class="modal-header">
                <h2>èº«ä»½éªŒè¯</h2>
                <button class="close-btn" id="closePasswordModal" aria-label="å…³é—­">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-description">è¯·è¾“å…¥è®¿é—®å¯†ç ä»¥è¿›å…¥ç®¡ç†ç³»ç»Ÿ</p>
                <div class="input-group">
                    <input type="password" id="passwordInput" placeholder="è¾“å…¥å¯†ç ..." autocomplete="off">
                    <button class="toggle-password" id="togglePassword" type="button">
                        <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPassword">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmPassword">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†åå°ç•Œé¢ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="adminInterface" style="display: none;">
        <header class="header">
            <div class="logo-small">
                <img src="logo.png" alt="è¿æ…•ç«™Logo" class="logo-image-small">
                <h1>è¿æ…•ç«™</h1>
            </div>
            <div class="user-info">
                <span>ç®¡ç†å‘˜</span>
                <button class="logout-btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
            </div>
        </header>

        <div class="main-content">
            <nav class="sidebar">
                <button class="nav-item active" data-page="dashboard">ğŸ“Š ä»ªè¡¨ç›˜</button>
                <button class="nav-item" data-page="upload">ğŸ“ æ–‡ä»¶ä¸Šä¼ </button>
                <button class="nav-item" data-page="files">ğŸ“‚ æ–‡ä»¶ç®¡ç†</button>
                <button class="nav-item" data-page="settings">âš™ï¸ ç³»ç»Ÿè®¾ç½®</button>
                <button class="nav-item" data-page="public">ğŸŒ è¿”å›å‰å°</button>
            </nav>

            <main class="content-area" id="contentArea">
                <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
                <div id="dashboardPage" class="page-content">
                    <h1 class="page-title">ç®¡ç†ä»ªè¡¨ç›˜</h1>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px;">
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“</div>
                            <div style="font-size: 24px; font-weight: 600; color: var(--gray-800);" id="totalFiles">0</div>
                            <div style="color: var(--gray-600);">æ€»æ–‡ä»¶æ•°</div>
                        </div>
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ’¾</div>
                            <div style="font-size: 24px; font-weight: 600; color: var(--gray-800);" id="totalSize">0 MB</div>
                            <div style="color: var(--gray-600);">æ€»å¤§å°</div>
                        </div>
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“¥</div>
                            <div style="font-size: 24px; font-weight: 600; color: var(--gray-800);" id="todayUploads">0</div>
                            <div style="color: var(--gray-600);">ä»Šæ—¥ä¸Šä¼ </div>
                        </div>
                        <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ‘¥</div>
                            <div style="font-size: 24px; font-weight: 600; color: var(--gray-800);">1</div>
                            <div style="color: var(--gray-600);">åœ¨çº¿ç®¡ç†å‘˜</div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                        <h3 style="margin-bottom: 16px; color: var(--gray-800);">æœ€è¿‘ä¸Šä¼ çš„æ–‡ä»¶</h3>
                        <div id="recentFilesList" style="max-height: 400px; overflow-y: auto;">
                            <!-- åŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶ä¸Šä¼ é¡µé¢ -->
                <div id="uploadPage" class="page-content" style="display: none;">
                    <h1 class="page-title">æ–‡ä»¶ä¸Šä¼ </h1>
                    <div class="upload-section">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">ğŸ“</div>
                            <div class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                            <div class="upload-hint">æ”¯æŒ ZIP, RAR, EXE, ARJ, PY ç­‰å¤šç§æ ¼å¼</div>
                            <input type="file" id="fileInput" class="file-input" multiple>
                            <button class="upload-btn" id="selectFiles">é€‰æ‹©æ–‡ä»¶</button>
                        </div>
                        
                        <div id="uploadProgress" style="margin-top: 24px; display: none;">
                            <div style="background: #e5e7eb; border-radius: 6px; overflow: hidden;">
                                <div id="progressBarFill" style="height: 8px; background: #6366f1; width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 14px; color: #6b7280;">
                                <span id="progressText">å‡†å¤‡ä¸Šä¼ ...</span>
                                <span id="progressPercent">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ–‡ä»¶ç®¡ç†é¡µé¢ -->
                <div id="filesPage" class="page-content" style="display: none;">
                    <h1 class="page-title">æ–‡ä»¶ç®¡ç†</h1>
                    <div class="files-section">
                        <div class="section-header">
                            <h2 class="section-title">æ‰€æœ‰æ–‡ä»¶</h2>
                            <div class="file-count" id="fileCount">å…± 0 ä¸ªæ–‡ä»¶</div>
                        </div>
                        <div id="filesTableContainer">
                            <table class="files-table" id="filesTable">
                                <thead>
                                    <tr>
                                        <th>æ–‡ä»¶å</th>
                                        <th>å¤§å°</th>
                                        <th>ä¸Šä¼ æ—¶é—´</th>
                                        <th>ä¸‹è½½æ¬¡æ•°</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="filesTableBody">
                                    <!-- åŠ¨æ€åŠ è½½æ–‡ä»¶åˆ—è¡¨ -->
                                </tbody>
                            </table>
                        </div>
                        <div id="emptyState" class="empty-state" style="display: none;">
                            <div class="empty-icon">ğŸ“­</div>
                            <p>æš‚æ— æ–‡ä»¶ï¼Œè¯·å…ˆä¸Šä¼ æ–‡ä»¶</p>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div id="settingsPage" class="page-content" style="display: none;">
                    <h1 class="page-title">ç³»ç»Ÿè®¾ç½®</h1>
                    <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: var(--shadow-sm);">
                        <div style="max-width: 600px;">
                            <h3 style="margin-bottom: 16px;">å®‰å…¨è®¾ç½®</h3>
                            <div style="margin-bottom: 24px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">ç®¡ç†å‘˜å¯†ç </label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="password" id="newPassword" placeholder="è¾“å…¥æ–°å¯†ç " 
                                           style="flex: 1; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                                    <button id="changePasswordBtn" class="btn btn-primary" style="width: auto;">ä¿®æ”¹å¯†ç </button>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 24px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="autoLogout" checked>
                                    <span>2å°æ—¶åè‡ªåŠ¨ç™»å‡º</span>
                                </label>
                            </div>
                            
                            <div style="border-top: 1px solid #e5e7eb; padding-top: 24px;">
                                <h3 style="margin-bottom: 16px;">å­˜å‚¨ä¿¡æ¯</h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                                    <div>
                                        <div style="font-size: 14px; color: #6b7280;">å­˜å‚¨è·¯å¾„</div>
                                        <div style="font-family: monospace; font-size: 14px;">/uploads</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; color: #6b7280;">æ–‡ä»¶ä¿ç•™æ—¶é—´</div>
                                        <div style="font-size: 14px;">æ°¸ä¹…ä¿ç•™</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="border-top: 1px solid #e5e7eb; padding-top: 24px; margin-top: 24px;">
                                <button id="clearAllDataBtn" class="btn btn-secondary" 
                                        style="background: #ef4444; color: white;">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ç¡®è®¤åˆ é™¤æ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="deleteModal">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2>ç¡®è®¤åˆ é™¤</h2>
                    <button class="close-btn" id="closeDeleteModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ <strong id="deleteFileName"></strong> å—ï¼Ÿ</p>
                    <p style="color: #ef4444; font-size: 14px; margin-top: 8px;">æ­¤æ“ä½œæ— æ³•æ’¤é”€</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelDelete">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="confirmDelete" style="background: #ef4444;">åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // èåˆåçš„ä¸»è„šæœ¬
        class IntegratedSite {
            constructor() {
                this.clickCount = 0;
                this.TARGET_CLICKS = 10;
                this.CORRECT_PASSWORD = 'syh123456mm';
                this.passwordAttempts = 0;
                this.MAX_PASSWORD_ATTEMPTS = 3;
                this.currentView = 'public';
                this.fileManager = null;
                
                this.init();
            }
            
            init() {
                // æ¸…é™¤æ—§çš„è®¤è¯çŠ¶æ€ï¼ˆç¡®ä¿æ¯æ¬¡æ‰“å¼€éƒ½æ˜¯è®¿å®¢æ¨¡å¼ï¼‰
                this.setAuthenticated(false);
                
                this.setupEventListeners();
                this.showPublicView();
                this.initializeFileManager();
            }
            
            setupEventListeners() {
                // Logoç‚¹å‡»äº‹ä»¶ï¼ˆéšè”½çš„ç®¡ç†å…¥å£ï¼‰
                const logoContainer = document.getElementById('logoContainer');
                logoContainer.addEventListener('click', (e) => {
                    this.handleLogoClick(e);
                });
                
                // å¯†ç æ¨¡æ€æ¡†äº‹ä»¶
                this.setupPasswordModal();
            }
            
            handleLogoClick(e) {
                this.clickCount++;
                
                // åˆ›å»ºå¾®å¦™çš„ç‚¹å‡»åé¦ˆï¼ˆä¸æ˜æ˜¾ï¼‰
                this.createSubtleClickEffect(e);
                
                if (this.clickCount >= this.TARGET_CLICKS) {
                    setTimeout(() => {
                        this.showPasswordModal();
                        this.clickCount = 0;
                    }, 200);
                }
            }
            
            createSubtleClickEffect(e) {
                // æç»†å¾®çš„è§†è§‰åé¦ˆï¼Œä¸æ˜æ˜¾
                const logo = e.currentTarget.querySelector('img');
                logo.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    logo.style.transform = 'scale(1)';
                }, 100);
            }
            
            setupPasswordModal() {
                const modal = document.getElementById('passwordModal');
                const confirmBtn = document.getElementById('confirmPassword');
                const cancelBtn = document.getElementById('cancelPassword');
                const closeBtn = document.getElementById('closePasswordModal');
                const togglePassword = document.getElementById('togglePassword');
                const passwordInput = document.getElementById('passwordInput');
                
                confirmBtn.addEventListener('click', () => this.verifyPassword());
                cancelBtn.addEventListener('click', () => this.hidePasswordModal());
                closeBtn.addEventListener('click', () => this.hidePasswordModal());
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) this.hidePasswordModal();
                });
                
                togglePassword.addEventListener('click', () => {
                    const type = passwordInput.type === 'password' ? 'text' : 'password';
                    passwordInput.type = type;
                });
                
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.verifyPassword();
                });
            }
            
            showPasswordModal() {
                const modal = document.getElementById('passwordModal');
                const input = document.getElementById('passwordInput');
                
                modal.classList.add('active');
                input.value = '';
                input.focus();
                this.passwordAttempts = 0;
            }
            
            hidePasswordModal() {
                const modal = document.getElementById('passwordModal');
                modal.classList.remove('active');
                document.getElementById('errorMessage').textContent = '';
            }
            
            verifyPassword() {
                const password = document.getElementById('passwordInput').value.trim();
                const errorEl = document.getElementById('errorMessage');
                
                if (!password) {
                    errorEl.textContent = 'è¯·è¾“å…¥å¯†ç ';
                    return;
                }
                
                if (password === this.CORRECT_PASSWORD) {
                    this.setAuthenticated(true);
                    this.hidePasswordModal();
                    this.showAdminView();
                    this.showToast('èº«ä»½éªŒè¯æˆåŠŸ', 'success');
                } else {
                    this.passwordAttempts++;
                    const remaining = this.MAX_PASSWORD_ATTEMPTS - this.passwordAttempts;
                    
                    if (remaining > 0) {
                        errorEl.textContent = `å¯†ç é”™è¯¯ï¼è¿˜å‰© ${remaining} æ¬¡æœºä¼š`;
                        document.getElementById('passwordInput').value = '';
                    } else {
                        this.hidePasswordModal();
                        this.showSecurityAlert();
                    }
                }
            }
            
            showSecurityAlert() {
                const alert = document.createElement('div');
                alert.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #ef4444;
                    color: white;
                    padding: 16px 24px;
                    border-radius: 8px;
                    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                    z-index: 9999;
                    font-weight: 500;
                `;
                alert.textContent = 'æ£€æµ‹åˆ°å¼‚å¸¸è®¿é—®è¡Œä¸º';
                document.body.appendChild(alert);
                
                setTimeout(() => alert.remove(), 3000);
            }
            
            showPublicView() {
                this.currentView = 'public';
                document.body.className = 'public-page';
                
                // æ˜¾ç¤ºå…¬å…±ç•Œé¢å…ƒç´ 
                document.querySelector('.public-header').style.display = 'block';
                document.querySelector('.public-content').style.display = 'block';
                
                // éšè—ç®¡ç†ç•Œé¢
                const adminInterface = document.getElementById('adminInterface');
                if (adminInterface) adminInterface.style.display = 'none';
            }
            
            showAdminView() {
                this.currentView = 'admin';
                document.body.className = 'admin-page';
                
                // éšè—å…¬å…±ç•Œé¢
                document.querySelector('.public-header').style.display = 'none';
                document.querySelector('.public-content').style.display = 'none';
                
                // æ˜¾ç¤ºç®¡ç†ç•Œé¢
                const adminInterface = document.getElementById('adminInterface');
                if (!adminInterface) {
                    this.createAdminInterface();
                } else {
                    adminInterface.style.display = 'block';
                }
                
                // åˆå§‹åŒ–æ–‡ä»¶ç®¡ç†å™¨
                if (this.fileManager) {
                    this.fileManager.switchPage('dashboard');
                }
            }
            
            createAdminInterface() {
                // åˆ›å»ºç®¡ç†ç•Œé¢HTMLï¼ˆä»åŸadmin.htmlæå–ï¼‰
                const adminHtml = `
                    <div id="adminInterface">
                        <!-- ç®¡ç†ç•Œé¢å†…å®¹ -->
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', adminHtml);
                
                // é‡æ–°åˆå§‹åŒ–æ–‡ä»¶ç®¡ç†å™¨
                this.initializeFileManager();
            }
            
            initializeFileManager() {
                // å®Œæ•´çš„æ–‡ä»¶ç®¡ç†å™¨
                this.fileManager = new PublicFileManager();
                
                // è®¾ç½®å¯¼èˆªåˆ‡æ¢äº‹ä»¶
                this.setupNavigationEvents();
                
                // è®¾ç½®é€€å‡ºç™»å½•
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        this.logout();
                    });
                }
            }
            
            setupNavigationEvents() {
                // å¯¼èˆªèœå•åˆ‡æ¢
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = item.dataset.page;
                        
                        if (page === 'public') {
                            // è¿”å›å‰å°
                            this.logout();
                            return;
                        }
                        
                        this.switchPage(page);
                        
                        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');
                    });
                });
                
                // æ–‡ä»¶ä¸Šä¼ ç›¸å…³äº‹ä»¶
                this.setupFileUploadEvents();
                
                // ç³»ç»Ÿè®¾ç½®äº‹ä»¶
                this.setupSettingsEvents();
            }
            
            setupFileUploadEvents() {
                const fileInput = document.getElementById('fileInput');
                const selectFiles = document.getElementById('selectFiles');
                const uploadArea = document.getElementById('uploadArea');
                
                if (selectFiles) {
                    selectFiles.addEventListener('click', () => fileInput.click());
                }
                
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        this.handleFileUpload(e.target.files);
                    });
                }
                
                // æ‹–æ‹½ä¸Šä¼ 
                if (uploadArea) {
                    uploadArea.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        uploadArea.classList.add('dragover');
                    });
                    
                    uploadArea.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        uploadArea.classList.remove('dragover');
                    });
                    
                    uploadArea.addEventListener('drop', (e) => {
                        e.preventDefault();
                        uploadArea.classList.remove('dragover');
                        this.handleFileUpload(e.dataTransfer.files);
                    });
                }
            }
            
            setupSettingsEvents() {
                // ä¿®æ”¹å¯†ç 
                const changePasswordBtn = document.getElementById('changePasswordBtn');
                if (changePasswordBtn) {
                    changePasswordBtn.addEventListener('click', () => {
                        this.changePassword();
                    });
                }
                
                // æ¸…é™¤æ•°æ®
                const clearAllDataBtn = document.getElementById('clearAllDataBtn');
                if (clearAllDataBtn) {
                    clearAllDataBtn.addEventListener('click', () => {
                        this.clearAllData();
                    });
                }
            }
            
            switchPage(page) {
                // éšè—æ‰€æœ‰é¡µé¢
                document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
                
                // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
                const pageMap = {
                    'dashboard': 'dashboardPage',
                    'upload': 'uploadPage',
                    'files': 'filesPage',
                    'settings': 'settingsPage'
                };
                
                const pageEl = document.getElementById(pageMap[page]);
                if (pageEl) {
                    pageEl.style.display = 'block';
                    
                    // æ ¹æ®é¡µé¢åŠ è½½ç›¸åº”æ•°æ®
                    switch(page) {
                        case 'dashboard':
                            if (this.fileManager) this.fileManager.renderDashboard();
                            break;
                        case 'files':
                            if (this.fileManager) this.fileManager.renderFilesTable();
                            break;
                    }
                }
            }
            
            handleFileUpload(files) {
                if (!files || files.length === 0) return;
                
                const validFiles = Array.from(files).filter(file => this.validateFile(file));
                
                if (validFiles.length === 0) {
                    this.showToast('æ²¡æœ‰æœ‰æ•ˆçš„æ–‡ä»¶è¢«é€‰æ‹©', 'warning');
                    return;
                }
                
                this.uploadFiles(validFiles);
            }
            
            validateFile(file) {
                const allowedTypes = [
                    'application/zip', 'application/x-rar-compressed', 'application/x-zip-compressed',
                    'application/x-executable', 'application/x-msdownload', 'text/x-python',
                    'application/x-arj', 'application/octet-stream'
                ];
                
                const allowedExtensions = ['.zip', '.rar', '.exe', '.arj', '.py', '.txt', '.pdf', 
                                           '.doc', '.docx', '.xls', '.xlsx', '.jpg', '.png', '.gif'];
                
                const fileName = file.name.toLowerCase();
                const fileExtension = '.' + fileName.split('.').pop();
                
                const isValidType = allowedTypes.includes(file.type) || 
                                   allowedExtensions.some(ext => fileName.endsWith(ext));
                
                const maxSize = 100 * 1024 * 1024;
                const isValidSize = file.size <= maxSize;
                
                if (!isValidSize) {
                    this.showToast(`æ–‡ä»¶ ${file.name} è¶…è¿‡100MBé™åˆ¶`, 'warning');
                    return false;
                }
                
                if (!isValidType) {
                    this.showToast(`æ–‡ä»¶ ${file.name} æ ¼å¼ä¸æ”¯æŒ`, 'warning');
                    return false;
                }
                
                return true;
            }
            
            async uploadFiles(files) {
                const progressContainer = document.getElementById('uploadProgress');
                const progressBar = document.getElementById('progressBarFill');
                const progressText = document.getElementById('progressText');
                const progressPercent = document.getElementById('progressPercent');
                
                if (!progressContainer) return;
                
                progressContainer.style.display = 'block';
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const totalProgress = ((i + 1) / files.length) * 100;
                    
                    progressText.textContent = `ä¸Šä¼ ä¸­: ${file.name}`;
                    progressPercent.textContent = Math.round(totalProgress) + '%';
                    progressBar.style.width = totalProgress + '%';
                    
                    await this.simulateFileUpload(file);
                }
                
                progressText.textContent = 'ä¸Šä¼ å®Œæˆï¼';
                progressPercent.textContent = '100%';
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 2000);
                
                this.showToast(`æˆåŠŸä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                
                // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
                if (this.fileManager) {
                    this.fileManager.files = this.fileManager.loadFiles();
                    this.fileManager.filteredFiles = [...this.fileManager.files];
                    this.fileManager.renderFiles();
                    this.fileManager.renderDashboard();
                }
            }
            
            simulateFileUpload(file) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const fileData = {
                            id: Date.now() + Math.random(),
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            uploadTime: new Date().toISOString(),
                            downloadCount: 0,
                            description: 'ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶'
                        };
                        
                        // ä¿å­˜åˆ°localStorage
                        const savedFiles = JSON.parse(localStorage.getItem('siteFiles') || '[]');
                        savedFiles.push(fileData);
                        localStorage.setItem('siteFiles', JSON.stringify(savedFiles));
                        
                        resolve();
                    }, 1000 + Math.random() * 2000);
                });
            }
            
            deleteFile(fileId) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) return;
                
                // ä»localStorageåˆ é™¤
                const savedFiles = JSON.parse(localStorage.getItem('siteFiles') || '[]');
                const updatedFiles = savedFiles.filter(f => f.id != fileId);
                localStorage.setItem('siteFiles', JSON.stringify(updatedFiles));
                
                // æ›´æ–°æ–‡ä»¶ç®¡ç†å™¨
                if (this.fileManager) {
                    this.fileManager.files = updatedFiles;
                    this.fileManager.filteredFiles = [...updatedFiles];
                    this.fileManager.renderFiles();
                    this.fileManager.renderDashboard();
                }
                
                this.showToast('æ–‡ä»¶å·²åˆ é™¤', 'success');
            }
            
            changePassword() {
                const newPassword = document.getElementById('newPassword').value;
                if (!newPassword) {
                    this.showToast('è¯·è¾“å…¥æ–°å¯†ç ', 'warning');
                    return;
                }
                
                if (newPassword.length < 6) {
                    this.showToast('å¯†ç é•¿åº¦è‡³å°‘6ä½', 'warning');
                    return;
                }
                
                // å­˜å‚¨æ–°å¯†ç 
                localStorage.setItem('adminPassword', newPassword);
                this.CORRECT_PASSWORD = newPassword;
                document.getElementById('newPassword').value = '';
                
                this.showToast('å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
            }
            
            clearAllData() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ–‡ä»¶æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    localStorage.removeItem('siteFiles');
                    
                    // é‡ç½®ä¸ºé»˜è®¤æ–‡ä»¶
                    if (this.fileManager) {
                        this.fileManager.files = this.fileManager.getDefaultFiles();
                        this.fileManager.filteredFiles = [...this.fileManager.files];
                        this.fileManager.renderFiles();
                        this.fileManager.renderDashboard();
                    }
                    
                    this.showToast('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤', 'warning');
                }
            }
            
            logout() {
                this.setAuthenticated(false);
                this.showPublicView();
                this.showToast('å·²é€€å‡ºç™»å½•', 'info');
                
                // å¼ºåˆ¶åˆ·æ–°é¡µé¢ç¡®ä¿å®Œå…¨é‡ç½®
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
            
            isAuthenticated() {
                return localStorage.getItem('isAuthenticated') === 'true';
            }
            
            setAuthenticated(value) {
                if (value) {
                    localStorage.setItem('isAuthenticated', 'true');
                    localStorage.setItem('authTime', Date.now().toString());
                } else {
                    localStorage.removeItem('isAuthenticated');
                    localStorage.removeItem('authTime');
                }
            }
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                const colors = {
                    success: '#10b981',
                    error: '#ef4444',
                    warning: '#f59e0b',
                    info: '#6366f1'
                };
                
                toast.style.cssText = `
                    position: fixed;
                    bottom: 24px;
                    right: 24px;
                    padding: 16px 24px;
                    background: white;
                    border-radius: 8px;
                    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                    border-left: 4px solid ${colors[type]};
                    transform: translateX(400px);
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    z-index: 2000;
                    max-width: 400px;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }
        
        // ä»files.htmlæå–çš„å…¬å…±æ–‡ä»¶ç®¡ç†å™¨
        class PublicFileManager {
            constructor() {
                this.files = this.loadFiles();
                this.filteredFiles = [...this.files];
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.showLoading();
                
                setTimeout(() => {
                    this.hideLoading();
                    this.renderFiles();
                }, 800);
            }
            
            setupEventListeners() {
                const searchInput = document.getElementById('searchInput');
                const sortSelect = document.getElementById('sortSelect');
                
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.filterFiles(e.target.value);
                    });
                }
                
                if (sortSelect) {
                    sortSelect.addEventListener('change', (e) => {
                        this.sortFiles(e.target.value);
                    });
                }
            }
            
            showLoading() {
                const loadingState = document.getElementById('loadingState');
                const fileGrid = document.getElementById('fileGrid');
                const emptyState = document.getElementById('emptyState');
                
                if (loadingState) loadingState.style.display = 'block';
                if (fileGrid) fileGrid.style.display = 'none';
                if (emptyState) emptyState.style.display = 'none';
            }
            
            hideLoading() {
                const loadingState = document.getElementById('loadingState');
                if (loadingState) loadingState.style.display = 'none';
            }
            
            loadFiles() {
                try {
                    const saved = localStorage.getItem('siteFiles');
                    return saved ? JSON.parse(saved) : this.getDefaultFiles();
                } catch (e) {
                    return this.getDefaultFiles();
                }
            }
            
            renderDashboard() {
                const totalFilesEl = document.getElementById('totalFiles');
                const totalSizeEl = document.getElementById('totalSize');
                const todayUploadsEl = document.getElementById('todayUploads');
                const recentFilesList = document.getElementById('recentFilesList');
                
                if (!totalFilesEl) return;
                
                const totalFiles = this.files.length;
                const totalSize = this.files.reduce((sum, file) => sum + file.size, 0);
                
                // è®¡ç®—ä»Šæ—¥ä¸Šä¼ 
                const today = new Date().toDateString();
                const todayUploads = this.files.filter(file => 
                    new Date(file.uploadTime).toDateString() === today
                ).length;
                
                totalFilesEl.textContent = totalFiles;
                totalSizeEl.textContent = this.formatFileSize(totalSize);
                todayUploadsEl.textContent = todayUploads;
                
                // æ¸²æŸ“æœ€è¿‘æ–‡ä»¶
                if (recentFilesList) {
                    const recentFiles = [...this.files]
                        .sort((a, b) => new Date(b.uploadTime) - new Date(a.uploadTime))
                        .slice(0, 10);
                    
                    if (recentFiles.length === 0) {
                        recentFilesList.innerHTML = '<p style="text-align: center; color: #9ca3af; padding: 40px;">æš‚æ— æ–‡ä»¶</p>';
                    } else {
                        recentFilesList.innerHTML = `
                            <table class="files-table">
                                <thead>
                                    <tr>
                                        <th>æ–‡ä»¶å</th>
                                        <th>å¤§å°</th>
                                        <th>ä¸Šä¼ æ—¶é—´</th>
                                        <th>ä¸‹è½½</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${recentFiles.map(file => `
                                        <tr>
                                            <td>
                                                <div class="file-name">
                                                    <span class="file-icon">${this.getFileIcon(file.name)}</span>
                                                    ${file.name}
                                                </div>
                                            </td>
                                            <td>${this.formatFileSize(file.size)}</td>
                                            <td>${this.formatDate(file.uploadTime)}</td>
                                            <td>${file.downloadCount}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                    }
                }
            }
            
            getDefaultFiles() {
                return [
                    {
                        id: 1,
                        name: 'ç¤ºä¾‹é¡¹ç›®.zip',
                        size: 2457600,
                        type: 'application/zip',
                        uploadTime: new Date(Date.now() - 86400000).toISOString(),
                        downloadCount: 15,
                        description: 'å®Œæ•´çš„é¡¹ç›®ç¤ºä¾‹ä»£ç '
                    },
                    {
                        id: 2,
                        name: 'æ•°æ®å¤„ç†è„šæœ¬.py',
                        size: 15360,
                        type: 'text/x-python',
                        uploadTime: new Date(Date.now() - 172800000).toISOString(),
                        downloadCount: 8,
                        description: 'Pythonæ•°æ®å¤„ç†è‡ªåŠ¨åŒ–è„šæœ¬'
                    },
                    {
                        id: 3,
                        name: 'èµ„æºå‹ç¼©åŒ….rar',
                        size: 5242880,
                        type: 'application/x-rar-compressed',
                        uploadTime: new Date(Date.now() - 259200000).toISOString(),
                        downloadCount: 23,
                        description: 'é¡¹ç›®æ‰€éœ€èµ„æºæ–‡ä»¶é›†åˆ'
                    },
                    {
                        id: 4,
                        name: 'å®‰è£…ç¨‹åº.exe',
                        size: 15728640,
                        type: 'application/x-msdownload',
                        uploadTime: new Date(Date.now() - 345600000).toISOString(),
                        downloadCount: 42,
                        description: 'è½¯ä»¶å®‰è£…ç¨‹åº'
                    }
                ];
            }
            
            filterFiles(searchTerm) {
                const term = searchTerm.toLowerCase().trim();
                
                if (!term) {
                    this.filteredFiles = [...this.files];
                } else {
                    this.filteredFiles = this.files.filter(file => 
                        file.name.toLowerCase().includes(term) ||
                        (file.description && file.description.toLowerCase().includes(term))
                    );
                }
                
                this.renderFiles();
            }
            
            sortFiles(sortBy) {
                switch (sortBy) {
                    case 'name':
                        this.filteredFiles.sort((a, b) => a.name.localeCompare(b.name));
                        break;
                    case 'date':
                        this.filteredFiles.sort((a, b) => new Date(b.uploadTime) - new Date(a.uploadTime));
                        break;
                    case 'size':
                        this.filteredFiles.sort((a, b) => b.size - a.size);
                        break;
                    case 'downloads':
                        this.filteredFiles.sort((a, b) => b.downloadCount - a.downloadCount);
                        break;
                }
                
                this.renderFiles();
            }
            
            renderFiles() {
                const fileGrid = document.getElementById('fileGrid');
                const emptyState = document.getElementById('emptyState');
                
                if (!fileGrid) return;
                
                if (this.filteredFiles.length === 0) {
                    fileGrid.style.display = 'none';
                    if (emptyState) emptyState.style.display = 'block';
                    return;
                }
                
                fileGrid.style.display = 'grid';
                if (emptyState) emptyState.style.display = 'none';
                
                fileGrid.innerHTML = this.filteredFiles.map(file => `
                    <div class="file-card">
                        <div class="file-card-icon">${this.getFileIcon(file.name)}</div>
                        <div class="file-card-name" title="${file.name}">${this.truncateFileName(file.name)}</div>
                        <div class="file-card-size">${this.formatFileSize(file.size)}</div>
                        <div class="file-card-date">${this.formatDate(file.uploadTime)}</div>
                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 13px; color: #6b7280; margin-bottom: 4px;">
                                ä¸‹è½½: ${file.downloadCount} æ¬¡
                            </div>
                            ${file.description ? `<div style="font-size: 12px; color: #9ca3af;">${file.description}</div>` : ''}
                        </div>
                        <button class="download-btn" onclick="integratedSite.fileManager.downloadFile('${file.id}')">
                            ç«‹å³ä¸‹è½½
                        </button>
                    </div>
                `).join('');
            }
            
            renderFilesTable() {
                const filesTableBody = document.getElementById('filesTableBody');
                const fileCount = document.getElementById('fileCount');
                const emptyState = document.getElementById('emptyState');
                const filesTable = document.getElementById('filesTable');
                
                if (!filesTableBody) return;
                
                if (this.files.length === 0) {
                    if (filesTable) filesTable.style.display = 'none';
                    if (emptyState) emptyState.style.display = 'block';
                    if (fileCount) fileCount.textContent = 'å…± 0 ä¸ªæ–‡ä»¶';
                    return;
                }
                
                if (filesTable) filesTable.style.display = 'table';
                if (emptyState) emptyState.style.display = 'none';
                if (fileCount) fileCount.textContent = `å…± ${this.files.length} ä¸ªæ–‡ä»¶`;
                
                const sortedFiles = [...this.files].sort((a, b) => 
                    new Date(b.uploadTime) - new Date(a.uploadTime)
                );
                
                filesTableBody.innerHTML = sortedFiles.map(file => `
                    <tr>
                        <td>
                            <div class="file-name">
                                <span class="file-icon">${this.getFileIcon(file.name)}</span>
                                ${file.name}
                            </div>
                        </td>
                        <td>${this.formatFileSize(file.size)}</td>
                        <td>${this.formatDate(file.uploadTime)}</td>
                        <td>${file.downloadCount}</td>
                        <td>
                            <div class="file-actions">
                                <button class="action-btn" onclick="integratedSite.fileManager.downloadFile('${file.id}')">
                                    ä¸‹è½½
                                </button>
                                <button class="action-btn delete" onclick="integratedSite.deleteFile('${file.id}')">
                                    åˆ é™¤
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
            
            getFileIcon(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                const iconMap = {
                    'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', 'arj': 'ğŸ“¦',
                    'exe': 'âš™ï¸', 'py': 'ğŸ', 'txt': 'ğŸ“„',
                    'pdf': 'ğŸ“‘', 'doc': 'ğŸ“', 'docx': 'ğŸ“',
                    'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š',
                    'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸'
                };
                return iconMap[ext] || 'ğŸ“';
            }
            
            truncateFileName(filename, maxLength = 20) {
                if (filename.length <= maxLength) return filename;
                const ext = filename.split('.').pop();
                const nameWithoutExt = filename.substring(0, filename.length - ext.length - 1);
                const truncatedName = nameWithoutExt.substring(0, maxLength - ext.length - 4);
                return `${truncatedName}...${ext}`;
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) {
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    if (hours === 0) {
                        const minutes = Math.floor(diff / (1000 * 60));
                        return minutes === 0 ? 'åˆšåˆš' : `${minutes}åˆ†é’Ÿå‰`;
                    }
                    return `${hours}å°æ—¶å‰`;
                } else if (days === 1) {
                    return 'æ˜¨å¤©';
                } else if (days < 7) {
                    return `${days}å¤©å‰`;
                } else {
                    return date.toLocaleDateString('zh-CN');
                }
            }
            
            downloadFile(fileId) {
                const file = this.files.find(f => f.id == fileId);
                if (!file) return;
                
                file.downloadCount++;
                
                try {
                    const saved = JSON.parse(localStorage.getItem('siteFiles') || '[]');
                    const index = saved.findIndex(f => f.id == fileId);
                    if (index !== -1) saved[index].downloadCount = file.downloadCount;
                    localStorage.setItem('siteFiles', JSON.stringify(saved));
                } catch (e) {
                    console.error('ä¿å­˜ä¸‹è½½è®¡æ•°å¤±è´¥:', e);
                }
                
                const content = `æ–‡ä»¶: ${file.name}\nå¤§å°: ${this.formatFileSize(file.size)}\nä¸Šä¼ æ—¶é—´: ${file.uploadTime}\nä¸‹è½½æ¬¡æ•°: ${file.downloadCount}`;
                const blob = new Blob([content], { type: file.type || 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.renderFiles();
            }
        }
        
        // åˆå§‹åŒ–
        let integratedSite;
        document.addEventListener('DOMContentLoaded', () => {
            integratedSite = new IntegratedSite();
            
            // å¼€å‘å·¥å…·ï¼šåœ¨æ§åˆ¶å°è¾“å…¥ loginAsAdmin() å¿«é€Ÿç™»å½•
            window.loginAsAdmin = () => {
                integratedSite.setAuthenticated(true);
                integratedSite.showAdminView();
                integratedSite.showToast('å¼€å‘è€…æ¨¡å¼ï¼šå·²ç™»å½•', 'success');
            };
            
            // å¼€å‘å·¥å…·ï¼šåœ¨æ§åˆ¶å°è¾“å…¥ logout() å¿«é€Ÿé€€å‡º
            window.logout = () => {
                integratedSite.logout();
            };
        });
    </script>
</body>
</html>